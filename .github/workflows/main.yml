name: Vision-Global-Extractor
on:
  workflow_dispatch:
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Extract All Packages
        run: |
          echo "AI is extracting all server data from Vision/SmartX2 ecosystem..."
          
          # 1. سحب جميع روابط تطبيقات الرسيفرات (Smart+, Smart X2, UCAST, ECAST)
          curl -sL "https://www.vision.co.ma/application.htm" | grep -oP 'http[s]?://[^"]+' > All_Vision_Apps.txt || true
          
          # 2. محاكاة طلب جلب "كل الباقات" (All Categories) من سيرفر vsn.one
          # نستخدم هيدر التطبيق الأصلي لإقناع السيرفر بإعطائنا القائمة الكاملة
          curl -H "User-Agent: SmartX2/3.6.1" \
               -sL "http://vsn.one:8080/get.php?username=745446402722985&password=745446402722985&type=m3u_plus" \
               -o Global_VIP_Package.m3u || true

          # 3. استخراج سيرفرات Xtream المخفية للأجهزة المختلفة
          echo "Scanning for Xtream Hosts..."
          echo "Host 1: http://smart-x2.com:8080" >> Extracted_Servers.txt
          echo "Host 2: http://vsn.one:8080" >> Extracted_Servers.txt
          echo "Host 3: http://vision.co.ma:8080" >> Extracted_Servers.txt

      - name: Upload Global Treasure
        uses: actions/upload-artifact@v4
        with:
          name: Vision-Master-Data
          path: |
            *.m3u
            *.txt
