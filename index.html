<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASIDI V6 PRO</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root { --red: #e31e24; --bg: #0a0a0a; --card: #161616; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; text-align: center; }
        header { background: #000; padding: 15px; border-bottom: 3px solid var(--red); }
        .main-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .category-card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px 10px; cursor: pointer; }
        .category-card i { font-size: 40px; color: var(--red); display: block; margin-bottom: 10px; }
        #content-list { display: none; padding: 20px; }
        .items-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .item { background: var(--card); border-radius: 10px; padding: 10px; border: 1px solid #222; }
        .item img { width: 100%; height: 90px; object-fit: contain; }
        .play-btn { background: var(--red); color: white; border: none; padding: 8px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 5px; }
        #player-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; }
        video { width: 100%; height: auto; background: #000; }
        .loading { display: none; color: var(--red); padding: 20px; font-weight: bold; }
    </style>
</head>
<body>

<div id="player-overlay">
    <video id="basidi-video" controls autoplay playsinline></video>
    <button onclick="closePlayer()" style="padding:15px; background:#333; color:white; border:none; width:100%;">âœ• Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø´ØºÙ„</button>
</div>

<header><h2>BASIDI <span style="color:var(--red)">V6</span> PRO</h2></header>

<div id="main-ui" class="main-menu">
    <div class="category-card" onclick="fetchData('live')"><i class='bx bx-tv'></i><span>Ù‚Ù†ÙˆØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©</span></div>
    <div class="category-card" onclick="fetchData('vod')"><i class='bx bx-film'></i><span>Ø£ÙÙ„Ø§Ù…</span></div>
    <div class="category-card" onclick="fetchData('series')"><i class='bx bx-collection'></i><span>Ù…Ø³Ù„Ø³Ù„Ø§Øª</span></div>
    <div class="category-card" onclick="location.reload()"><i class='bx bx-refresh'></i><span>ØªØ­Ø¯ÙŠØ«</span></div>
</div>

<div id="loader" class="loading">Ø¬Ø§Ø±ÙŠ Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>

<div id="content-list">
    <button onclick="backToMenu()" style="color:white; background:var(--red); border:none; padding:10px; margin-bottom:15px; border-radius:5px;">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
    <div id="items-container" class="items-grid"></div>
</div>

<script>
    const config = { h: "http://bufsetn.live:8080", u: "VaRumDmgRh", p: "hopeful5sex" };
    
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ³ÙŠØ· AllOrigins Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© timestamp Ù„ØªØ¬Ø§ÙˆØ² Ø§Ù„ÙƒØ§Ø´
    const proxy = "https://api.allorigins.win/get?url=";
    let hls = new Hls();

    async function fetchData(mode) {
        $("#main-ui").hide();
        $("#loader").show();
        
        const action = mode === 'live' ? 'get_live_streams' : (mode === 'vod' ? 'get_vod_streams' : 'get_series');
        const apiUrl = `${config.h}/player_api.php?username=${config.u}&password=${config.p}&action=${action}`;

        try {
            const resp = await fetch(proxy + encodeURIComponent(apiUrl) + "&callback=?");
            const result = await resp.json();
            // AllOrigins ÙŠØ¶Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø§Ø®Ù„ Ø­Ù‚Ù„ Ø§Ø³Ù…Ù‡ contents ÙƒØ³Ù„Ø³Ù„Ø© Ù†ØµÙŠØ©
            const data = JSON.parse(result.contents);
            
            $("#loader").hide();
            $("#content-list").show();
            render(data, mode);
        } catch (e) {
            $("#loader").hide();
            $("#main-ui").show();
            alert("Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ±ÙØ¶ Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ù…Ø¨Ø§Ø´Ø±. Ø¬Ø±Ø¨ ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙØ­Ø©.");
        }
    }

    function render(data, mode) {
        let html = "";
        data.slice(0, 40).forEach(item => {
            let img = item.stream_icon || item.cover || 'https://via.placeholder.com/100/222/white?text=BASIDI';
            html += `
                <div class="item">
                    <img src="${img}">
                    <p style="font-size:11px; height:25px; overflow:hidden;">${item.name}</p>
                    <button class="play-btn" onclick="play('${item.stream_id || item.series_id}', '${mode}', '${item.container_extension}')">â–¶ ØªØ´ØºÙŠÙ„</button>
                </div>`;
        });
        $("#items-container").html(html);
    }

    function play(id, mode, ext) {
        $("#player-overlay").css("display", "flex");
        const v = document.getElementById('basidi-video');
        let url = (mode === 'live') ? `${config.h}/live/${config.u}/${config.p}/${id}.ts` : `${config.h}/movie/${config.u}/${config.p}/${id}.${ext || 'mp4'}`;
        
        if (Hls.isSupported()) {
            hls.destroy(); hls = new Hls();
            hls.loadSource(url); hls.attachMedia(v);
            hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
        } else { v.src = url; v.play(); }
    }

    function closePlayer() { document.getElementById('basidi-video').pause(); $("#player-overlay").hide(); hls.destroy(); }
    function backToMenu() { $("#content-list").hide(); $("#main-ui").show(); }
</script>
</body>
</html>
