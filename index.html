<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASIDI V6 PRO</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root { --red: #e31e24; --bg: #0a0a0a; --card: #161616; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; overflow-x: hidden; }
        header { background: #000; padding: 15px; text-align: center; border-bottom: 3px solid var(--red); sticky; top: 0; z-index: 100; }
        
        /* واجهة الأقسام */
        .main-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .category-card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px 10px; text-align: center; cursor: pointer; transition: 0.3s; }
        .category-card i { font-size: 40px; color: var(--red); display: block; margin-bottom: 10px; }
        
        /* قائمة القنوات */
        #content-list { display: none; padding: 20px; }
        .items-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .item { background: var(--card); border-radius: 10px; padding: 10px; text-align: center; border: 1px solid #222; }
        .item img { width: 100%; height: 100px; object-fit: contain; border-radius: 5px; margin-bottom: 8px; }
        .play-btn { background: var(--red); color: white; border: none; padding: 8px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; }

        /* المشغل */
        #player-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; }
        video { width: 100%; height: auto; max-height: 80vh; background: #000; }
        .back-btn { background: #333; color: white; border: none; padding: 10px; width: 100%; cursor: pointer; font-size: 16px; }
        
        .loading { display: none; color: var(--red); padding: 20px; text-align: center; }
    </style>
</head>
<body>

<div id="player-overlay">
    <video id="basidi-video" controls autoplay playsinline></video>
    <button class="back-btn" onclick="closePlayer()">✕ العودة للقائمة</button>
</div>

<header>
    <h2 id="nav-title">BASIDI <span style="color:var(--red)">V6</span> PRO</h2>
</header>

<div id="main-ui" class="main-menu">
    <div class="category-card" onclick="fetchData('live')"><i class='bx bx-tv'></i><span>قنوات مباشرة</span></div>
    <div class="category-card" onclick="fetchData('vod')"><i class='bx bx-film'></i><span>أفلام</span></div>
    <div class="category-card" onclick="fetchData('series')"><i class='bx bx-collection'></i><span>مسلسلات</span></div>
    <div class="category-card" onclick="location.reload()"><i class='bx bx-refresh'></i><span>تحديث</span></div>
</div>

<div id="content-list">
    <button onclick="backToMenu()" style="color:var(--red); background:none; border:none; margin-bottom:15px; cursor:pointer;"><i class='bx bx-arrow-back'></i> رجوع</button>
    <div id="items-container" class="items-grid"></div>
</div>

<div id="loader" class="loading">جاري جلب البيانات...</div>

<script>
    const config = { h: "http://bufsetn.live:8080", u: "VaRumDmgRh", p: "hopeful5sex" };
    const proxy = "https://api.allorigins.win/raw?url=";
    let hls = new Hls();

    async function fetchData(mode) {
        $("#main-ui").hide();
        $("#content-list").hide();
        $("#loader").show();
        
        let action = mode === 'live' ? 'get_live_streams' : (mode === 'vod' ? 'get_vod_streams' : 'get_series');
        let url = `${config.h}/player_api.php?username=${config.u}&password=${config.p}&action=${action}`;
        
        try {
            const response = await fetch(proxy + encodeURIComponent(url));
            const data = await response.json();
            displayItems(data, mode);
        } catch (error) {
            alert("حدث خطأ في جلب البيانات");
            backToMenu();
        }
    }

    function displayItems(items, mode) {
        $("#loader").hide();
        $("#content-list").show();
        let html = "";
        
        // عرض أول 50 عنصر فقط لتسريع الصفحة
        items.slice(0, 50).forEach(item => {
            let img = item.stream_icon || item.cover || 'https://via.placeholder.com/150/000000/FFFFFF?text=BASIDI';
            let id = item.stream_id || item.series_id;
            html += `
                <div class="item">
                    <img src="${img}" onerror="this.src='https://via.placeholder.com/150/222/white?text=No+Image'">
                    <p style="font-size:12px; height:30px; overflow:hidden;">${item.name}</p>
                    <button class="play-btn" onclick="playMedia('${id}', '${mode}', '${item.container_extension}')">▶ تشغيل</button>
                </div>
            `;
        });
        $("#items-container").html(html);
    }

    function playMedia(id, mode, ext) {
        $("#player-overlay").css("display", "flex");
        const video = document.getElementById('basidi-video');
        let streamUrl = "";
        
        if(mode === 'live') streamUrl = `${config.h}/live/${config.u}/${config.p}/${id}.ts`;
        else if(mode === 'vod') streamUrl = `${config.h}/movie/${config.u}/${config.p}/${id}.${ext || 'mp4'}`;

        if (Hls.isSupported()) {
            hls.destroy();
            hls = new Hls();
            hls.loadSource(streamUrl);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else {
            video.src = streamUrl;
            video.play();
        }
    }

    function closePlayer() {
        const video = document.getElementById('basidi-video');
        video.pause();
        hls.destroy();
        $("#player-overlay").hide();
    }

    function backToMenu() {
        $("#content-list").hide();
        $("#loader").hide();
        $("#main-ui").show();
    }
</script>
</body>
</html>
