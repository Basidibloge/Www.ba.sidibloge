<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BASIDI V6 PRO</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        :root { --red: #e31e24; --bg: #0a0a0a; --card: #161616; }
        body { background: var(--bg); color: white; font-family: sans-serif; margin: 0; text-align: center; }
        header { background: #000; padding: 15px; border-bottom: 3px solid var(--red); box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .main-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; padding: 20px; }
        .category-card { background: var(--card); border: 1px solid #222; border-radius: 15px; padding: 25px 10px; cursor: pointer; transition: 0.3s; }
        .category-card:active { transform: scale(0.95); background: #222; }
        .category-card i { font-size: 40px; color: var(--red); display: block; margin-bottom: 10px; }
        #content-list { display: none; padding: 20px; }
        .items-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .item { background: var(--card); border-radius: 10px; padding: 10px; border: 1px solid #222; position: relative; }
        .item img { width: 100%; height: 90px; object-fit: contain; background: #000; border-radius: 5px; }
        .play-btn { background: var(--red); color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; margin-top: 8px; font-weight: bold; }
        #player-overlay { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; }
        video { width: 100%; height: auto; background: #000; flex-grow: 1; }
        .close-vid { padding: 15px; background: #333; color: white; border: none; width: 100%; font-size: 18px; font-weight: bold; }
        .loading { display: none; color: var(--red); padding: 30px; font-size: 18px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="player-overlay">
    <video id="basidi-video" controls autoplay playsinline></video>
    <button class="close-vid" onclick="closePlayer()">âœ• Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø´ØºÙ„</button>
</div>

<header><h2>BASIDI <span style="color:var(--red)">V6</span> PRO</h2></header>

<div id="main-ui" class="main-menu">
    <div class="category-card" onclick="fetchData('live')"><i class='bx bx-tv'></i><span>Ù‚Ù†ÙˆØ§Øª Ù…Ø¨Ø§Ø´Ø±Ø©</span></div>
    <div class="category-card" onclick="fetchData('vod')"><i class='bx bx-film'></i><span>Ø£ÙÙ„Ø§Ù…</span></div>
    <div class="category-card" onclick="fetchData('series')"><i class='bx bx-collection'></i><span>Ù…Ø³Ù„Ø³Ù„Ø§Øª</span></div>
    <div class="category-card" onclick="location.reload()"><i class='bx bx-refresh'></i><span>ØªØ­Ø¯ÙŠØ«</span></div>
</div>

<div id="loader" class="loading">â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±...</div>

<div id="content-list">
    <button onclick="backToMenu()" style="color:white; background:var(--red); border:none; padding:12px 25px; margin-bottom:20px; border-radius:30px; font-weight:bold;">ğŸ”™ Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <div id="items-container" class="items-grid"></div>
</div>

<script>
    const config = { h: "http://bufsetn.live:8080", u: "VaRumDmgRh", p: "hopeful5sex" };
    const proxy = "https://api.allorigins.win/get?url=";
    let hls = new Hls();

    async function fetchData(mode) {
        $("#main-ui").hide();
        $("#loader").show();
        
        const action = mode === 'live' ? 'get_live_streams' : (mode === 'vod' ? 'get_vod_streams' : 'get_series');
        const apiUrl = `${config.h}/player_api.php?username=${config.u}&password=${config.p}&action=${action}`;

        try {
            const resp = await fetch(proxy + encodeURIComponent(apiUrl));
            const result = await resp.json();
            // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ù„Ùˆ Ø¬Ø§Ø¡Øª Ø¨ØµÙŠØºØ© Ù†ØµÙŠØ©
            const data = typeof result.contents === 'string' ? JSON.parse(result.contents) : result.contents;
            
            $("#loader").hide();
            $("#content-list").show();
            renderItems(data, mode);
        } catch (e) {
            $("#loader").hide();
            $("#main-ui").show();
            alert("âš ï¸ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙŠØ­ØªØ§Ø¬ Ù„ÙˆÙ‚Øª Ø£Ø·ÙˆÙ„ Ù„Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©. Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ø§Ù‹ Ø¨Ø¹Ø¯ Ø«ÙˆØ§Ù†Ù.");
        }
    }

    function renderItems(data, mode) {
        let html = "";
        // Ø¹Ø±Ø¶ Ø£ÙˆÙ„ 100 Ø¹Ù†ØµØ±
        const list = Array.isArray(data) ? data : [];
        list.slice(0, 100).forEach(item => {
            let img = item.stream_icon || item.cover || 'https://via.placeholder.com/150/111/white?text=BASIDI';
            html += `
                <div class="item">
                    <img src="${img}" onerror="this.src='https://via.placeholder.com/150/111/white?text=No+Logo'">
                    <p style="font-size:11px; margin: 5px 0; height:28px; overflow:hidden; line-height:1.2;">${item.name}</p>
                    <button class="play-btn" onclick="play('${item.stream_id || item.series_id}', '${mode}', '${item.container_extension}')">â–¶ ØªØ´ØºÙŠÙ„</button>
                </div>`;
        });
        $("#items-container").html(html || "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØ§Ø­Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</p>");
    }

    function play(id, mode, ext) {
        $("#player-overlay").css("display", "flex");
        const v = document.getElementById('basidi-video');
        let url = (mode === 'live') ? `${config.h}/live/${config.u}/${config.p}/${id}.ts` : `${config.h}/movie/${config.u}/${config.p}/${id}.${ext || 'mp4'}`;
        
        if (Hls.isSupported()) {
            hls.destroy(); hls = new Hls();
            hls.loadSource(url); hls.attachMedia(v);
            hls.on(Hls.Events.MANIFEST_PARSED, () => v.play());
        } else { v.src = url; v.play(); }
    }

    function closePlayer() { 
        const v = document.getElementById('basidi-video');
        v.pause(); 
        v.src = "";
        $("#player-overlay").hide(); 
        if(hls) hls.destroy(); 
    }
    
    function backToMenu() { $("#content-list").hide(); $("#main-ui").show(); }
</script>
</body>
</html>
